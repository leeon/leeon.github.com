<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>JavaScript 中的DOM事件</title>
  <meta name="description" content="" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://atleeon.com/code/2014/03/01/javascript-event.html">

  <link rel="shortcut icon" href="http://cdn4atleeon.qiniudn.com/image/site/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/css/style.css" />
  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

  <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
  <script type="text/javascript" src="/assets/js/index.js"></script>
  <!-- <script type="text/javascript" src="/assets/js/readingTime.min.js"></script> -->
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->
<!-- 
<a href="http://atleeon.com" class="logo-readium"><span class="logo" style="background-image: url(http://cdn4atleeon.qiniudn.com/image/site/author/leeon/leeon.jpg)"></span></a>
 -->
<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">JavaScript 中的DOM事件</h1>
          </div>
        </div>
        <br>
        <!-- 无封面时不显示正文 -->
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> atleeon.com
          </div>
          <a name="topofpage"></a>
          <h2 id="intro">Intro</h2>

<p>本文描述的 事件 是W3C定义的API, 这些事件应用在JavaScript对于DOM的操作（Node.js中也有相应的事件机制）。事件主要是监控发生在DOM元素上面的行为，当一个元素的状态改变的时候，比如点击了页面上的某个标签，就会触发事件。</p>

<!-- break -->

<h2 id="basic-concepts">Basic Concepts</h2>

<h3 id="document">document</h3>
<p>首先回顾一下DOM(Document Object Model)相关的一些基本概念。HTML文档是一棵树的形式组织的，不同的标签被转换成一个节点,这是有了这些节点，JavaScript才能自如的操作页面元素。比如下面的代码：</p>

<pre><code>&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;My Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Header&lt;/h1&gt;
  &lt;p&gt;Paragraph&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>浏览器在渲染这个页面的时候，会以树的形式组织页面，如下图：</p>

<p class="center"><img src="http://cdn4atleeon.qiniudn.com/image/code/2014dom-tree.jpeg" alt="" style="max-width:400px" /></p>

<p class="center">DOM结构</p>

<p>可以看到树根元素就是<code>document</code>,表示整个文档对象，通过它可以操作dom节点。比如：</p>

<pre><code>var elem = document.getElementById('button');
var newELem = document.createElement("div");
</code></pre>

<h3 id="window">window</h3>
<p>window是JavaScript中的全局变量，所有的全局变量都作为window的属性存在。使用window也可以监控浏览器的窗口事件。例如下面的代码可以关闭浏览器窗口：</p>

<pre><code>window.close();
</code></pre>

<h3 id="eventtarget">EventTarget</h3>

<blockquote>
  <p>EventTarget is a DOM interface implemented by objects that can receive DOM events and have listeners for them.</p>
</blockquote>

<p>EventTarget是定义的一个接口，通过这个接口，实现对于DOM事件的支持。Element,document,和window都是最常用的EventTarget，他们还支持on..（如onCLick,现代浏览器推荐addEventListener方法）事件绑定。EventTarget还包括XMLHttpRequest,AudiNode和AudioContext等。</p>

<p>EventTarget提供三个重要的方法：</p>

<ul>
  <li>target.addEventListener(type, listener[, useCapture]);</li>
  <li>target.removeEventListener(type, listener[, useCapture]);</li>
  <li>canceled = !target.dispatchEvent(event);</li>
</ul>

<h2 id="using-built-in-events">Using built-in events</h2>

<p>大多数场景下，我们只需要使用内置的事件类型就足够了。DOM API提供的事件比较丰富，常用的有:</p>

<ul>
  <li>鼠标事件 <code>mousedown</code>,<code>mouse up</code>,<code>click</code>,<code>mouseover</code>,<code>mouseout</code></li>
  <li>键盘事件 <code>keypress</code>,<code>keydown</code>,<code>keyup</code></li>
  <li>表单事件 <code>select</code>,<code>change</code>,<code>submit</code>,<code>focus</code>,<code>reset</code></li>
  <li>页面事件 <code>load</code>,<code>scroll</code></li>
</ul>

<p>假如我们的网页有下面的结构：</p>

<pre><code>&lt;div&gt;&lt;a id="bt" href="octsky.com"&gt;Click me!&lt;/a&gt;&lt;/div&gt;
</code></pre>

<p>在js代码中：</p>

<pre><code>var bt = document.getElementByIn('bt');

function myClickHandler(e){
    alert('button is clicked.');
}

bt.addEventListener('click',myClickHandler,false);

//you can also do this:
//bt.onclick = myClickHandler;
</code></pre>

<p>代码中有两个不同的绑定事件的方法，重要的区别在于第二种通过onclick赋值的方法只能给一个元素绑定一个事件，而addEventListener的方式可以实现多个事件的绑定。</p>

<p>当我们点击<code>&lt;a&gt;</code>标签的时候，浏览器会出现弹窗，然后页面跳转至<code>octsky.com</code>的页面，如果我们不希望页面跳转，阻止a标签的默认行为，使用</p>

<pre><code>e.preventDefault();
</code></pre>

<p>这里<code>e</code>是，作为Event Handler函数，默认传入的参数，代表事件本身，并且可以通过他获得事件的一些属性。</p>

<h2 id="creating-and-triggering-events">Creating and triggering events</h2>

<pre><code>    var button = document.getElementById('button');
    var event = new Event('go');
    
    // Listen to the event
    button.addEventListener('go',function  (e) {
        alert('in go event');
    },false);
    
    // Dispatch the event
    button.dispatchEvent(event);
</code></pre>

<p>上面的代码创建了一个自定义事件，并且绑定到了<code>button</code>这个dom元素上，最后手动触发事件执行。这种方法大部分的现代浏览器都支持。注意addEventListener()最后一个参数，false表示不使用事件捕获，后面介绍。</p>

<h2 id="event-capture--bubble">Event Capture &amp; Bubble</h2>

<p>前面提到了事件捕获，事件捕获是一种事件传递的机制，DOM中主要有两种事件的传递机制:<strong>事件捕获</strong>和<strong>事件冒泡</strong>。前者的浏览器支持不完整，后者比较完整。</p>

<p>二者的主要区别从图中可以看出，当一个element被click的时候，如果使用事件捕获，dom跟元素document会创建事件流，一直向树叶节点元素传播，捕获事件(Capture phase),直到找到真正触发事件的目标元素，过程中，只有目标元素的事件onclick事件会在目标阶段（Target phase）触发。如果使用事件冒泡，事件从目标元素发起，向上传播，直到某个节点调用了阻止冒泡，或者到达了跟节点。过程中经过的element的click事件都会被触发，（这是事件委托的原理）。</p>

<p class="center"><img src="http://cdn4atleeon.qiniudn.com/image/code/2014event-model.jpg" alt="" style="max-width:400px" /></p>

<p class="center">事件冒泡与捕获</p>

<p>addEventListener方法默认关闭事件捕获，开启事件冒泡。如果阻止事件冒泡可以使用：</p>

<pre><code>event.stopPropagation();
</code></pre>

<h2 id="event-delegation">Event delegation</h2>

<p>事件委托是什么概念呢？一个常用的场景是列表管理。列表里有很多元素，并且是动态变化的（比如web版的文件管理器）.</p>

<pre><code>&lt;ul id="file-list"&gt;
    &lt;li&gt;item&lt;/li&gt;
    &lt;!--many other--&gt;
    &lt;li&gt;item&lt;/li&gt;   
&lt;/ul&gt;
</code></pre>

<p>如果给每一个li元素绑定事件会非常的难以管理，这个时候利用冒泡机制的原理，可以绑定事件给<code>&lt;ul&gt;</code>元素，他的每一个子元素事件触发的时候都会冒泡到父元素。再由<code>&lt;ul&gt;</code>统一处理。</p>

<pre><code>var filelist = document.getElementById('file-list);
filelist.addEventListener('click',function(e){
    if(e.target){
        //do something special
    }
},false);
</code></pre>

<p>注意：事件委托的前提是使用事件冒泡。</p>

<h2 id="conclusion">Conclusion</h2>

<p>本文介绍了JavaScript DOM事件的一些基础的概念，Event是DOM的核心内容，理解基本的概念可以更好的使用一些高级的框架。</p>

<p>推荐阅读 <a href="http://www.w3.org/TR/DOM-Level-3-Events/#dom-event-architecture">W3c DOM Event architecture</a></p>

<p>以上。</p>


        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=JavaScript+%E4%B8%AD%E7%9A%84DOM%E4%BA%8B%E4%BB%B6&amp;url=http://atleeon.com/code/2014/03/01/javascript-event"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
              
                <a class="icon-weibo" href="http://service.weibo.com/share/share.php?title=JavaScript+%E4%B8%AD%E7%9A%84DOM%E4%BA%8B%E4%BB%B6&amp;url=http://atleeon.com/code/2014/03/01/javascript-event"
                  onclick="window.open(this.href, 'weibo-share', 'width=550,height=255');return false;">
                <i class="fa fa-weibo"></i><span class="hidden">weibo</span>
                </a>
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>戳</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(http://cdn4atleeon.qiniudn.com/image/site/author/leeon/leeon.jpg)">Blog Logo</div>
              <h4>Leeon</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">写于 
                <time datetime="2014-03-01 00:00">
                    2014 年 03 月 01 日
                </time>
              </p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span> 乱步 </span></h5>
            <footer class="site-footer">
              
              <p class="published" style="text-align: center;">
                  <a href="/code/2014/02/26/javascript-basic.html" class="pre">
                    <i class="fa fa-caret-left"></i>
                    JavaScript中的 变量、作用域链、执行上下文 
                  </a>
              </p>
              

              
              <p class="published" style="text-align: center;">
                <a href="/code/2014/03/06/javascript-scoping-hoisting.html" class="next"> 
                  JavaScript Scoping and Hoisting 
                  <i class="fa fa-caret-right"></i>
                </a>
              </p>
              

              <!-- <a class="subscribe" href="/feed.xml"> <span class="tooltip">  -->
              </div>
            </footer>
          </div>
        </div>
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/cA4aKEIPQrerBnp1yGHv_IMG_9534-3-2.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Zephyrus</h1>
        <h2 class="blog-description"></h2>
        <a href="/" class="btn">首 页</a>
      </div>
    </div>
  </body>
</html>
