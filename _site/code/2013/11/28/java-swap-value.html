<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>由swap引出的java中参数严格值传递问题</title>
  <meta name="description" content="" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://atleeon.com/code/2013/11/28/java-swap-value.html">

  <link rel="shortcut icon" href="http://cdn4atleeon.qiniudn.com/image/site/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/css/style.css" />
  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

  <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
  <script type="text/javascript" src="/assets/js/index.js"></script>
  <!-- <script type="text/javascript" src="/assets/js/readingTime.min.js"></script> -->
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->
<!-- 
<a href="http://atleeon.com" class="logo-readium"><span class="logo" style="background-image: url(http://cdn4atleeon.qiniudn.com/image/site/author/leeon/leeon.jpg)"></span></a>
 -->
<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">由swap引出的java中参数严格值传递问题</h1>
          </div>
        </div>
        <br>
        <!-- 无封面时不显示正文 -->
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> atleeon.com
          </div>
          <a name="topofpage"></a>
          <blockquote>
  <p>晚上看到一篇非常有意思的文章《<a href="http://www.roseindia.net/java/beginners/swapping.shtml">Swapping of two numbers</a>》,讲的是如何用Java语言实现swap方法。看到作者的代码，实在逗坏了，而且这篇文章在Google搜索如何实现Java swap中排名非常靠前，如果感兴趣可以看一下文章以及评论。</p>
</blockquote>

<!-- break -->
<p>##Bad Swap
实际上类似作者的交换代码，在Java中是无效的。原因是Java中参数传递是<strong>严格</strong>的按照<code>value</code>传递的。所以只改变参数<strong>本身</strong>的数值，并不会影响外面。这一点很好理解。</p>

<pre><code>public void badSwap(int a, int b){
    int temp = a;
    a = b;
    b = temp;
}
</code></pre>

<h2 id="what-about-swap-two-object">What about swap two object?</h2>

<p>Java的对象实例是用reference来维护的，那么交换两个对象实例会不会有效呢？比如下面的代码结果会怎么样？</p>

<pre><code>public static void swapObj(Point a, Point b) {
    Point temp = a;
    a = b;
    b = temp;
}

public static void main(String[] args) {    
    Point px = new Point(0,0);
    Point py = new Point(1,1);
    swapObj(px,py);
}
</code></pre>

<p>答案依旧是否定的。原因是当对象作为参数被传递的时候，传进去的实际上也是值，这个值是reference本身的一个拷贝。下图中，当px和py作为参数，进行方法调用时，实际上会生成px和py的一份”拷贝”，注意拷贝的是px和py的值.然后把这对<strong>值</strong>传入了方法，交换结束后，argx和argy各自指向了新的对象实例，但是方法之外的px和py并没有变化，这就是对象实例交换失败的原因。</p>

<p class="center"><img src="http://cdn4atleeon.qiniudn.com/image%2F2013%2Fcode%2Fjava-obj-swap.png" alt="" style="max-width:400px" /></p>

<h2 id="tricky-code">Tricky Code</h2>

<p><a href="http://www.javaworld.com/javaworld/javaqa/2000-05/03-qa-0526-pass.html">JavaWorld</a>的一个问题中，Tony Sintes给出了下面一段Tricky代码，这段代码的结果是什么？</p>

<pre><code>public void tricky(Point arg1, Point arg2)
{
  arg1.x = 100;
  arg1.y = 100;
  Point temp = arg1;
  arg1 = arg2;
  arg2 = temp;
}
public static void main(String [] args)
{
  Point pnt1 = new Point(0,0);
  Point pnt2 = new Point(0,0);
  System.out.println("X: " + pnt1.x + " Y: " +pnt1.y); 
  System.out.println("X: " + pnt2.x + " Y: " +pnt2.y);
  System.out.println(" ");
  tricky(pnt1,pnt2);
  System.out.println("X: " + pnt1.x + " Y:" + pnt1.y); 
  System.out.println("X: " + pnt2.x + " Y: " +pnt2.y);  
}
</code></pre>

<p>结果是 赋值成功，交换失败。</p>

<pre><code>X: 0 Y: 0
X: 0 Y: 0
X: 100 Y: 100
X: 0 Y: 0
</code></pre>

<p>在方法的内部，赋值操作影响了外面的对象，而交换操作没有效果。原因在<code>arg1.x</code>是通过引用实际上操作了方法外面的对象。而交换操作仍然只是改改变arg1参数本身的值.不会影响外面。</p>

<h2 id="summary">Summary</h2>

<p>解释上面例子的两个基本的Rule是：</p>

<ul>
  <li>Java中参数传递是严格的值传递</li>
  <li>Java通过reference来维护对象实例</li>
</ul>

<p>要在一个方法内部实现外部数据的swap,一个基本的前提是<strong>可以操作到外面的对象</strong>，否则当方法结束返回，所做的操作都没有作用了。本例中我们没有能够操作px和py本身，所以交换操作没有作用。</p>

<p>在C语言中，可以使用传递指针的方式实现有效的<code>Swap()</code>,原因在于C提供了直接的<code>取地址</code>和<code>引用地址</code>的操作。Java则没有提供直接操作内存地址的操作，因此不容易实现形如<code>swap(Object x,Object y)</code>的方法。</p>

<h2 id="solution">Solution</h2>
<p>在Java中实现交换，经常借助于数组，一般形式为 </p>

<pre><code>public static void exec(Object[] a, int x, int y);
</code></pre>

<p>至于原理，可以按照Rule 2 来理解。</p>

<hr />

<p>参考资料：</p>

<ul>
  <li><a href="http://www.javaworld.com/javaworld/javaqa/2000-05/03-qa-0526-pass.html">JavaWorld</a></li>
  <li><a href="http://www.roseindia.net/java/beginners/swapping.shtml">Swapping of two numbers</a></li>
</ul>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=%E7%94%B1swap%E5%BC%95%E5%87%BA%E7%9A%84java%E4%B8%AD%E5%8F%82%E6%95%B0%E4%B8%A5%E6%A0%BC%E5%80%BC%E4%BC%A0%E9%80%92%E9%97%AE%E9%A2%98&amp;url=http://atleeon.com/code/2013/11/28/java-swap-value"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
              
                <a class="icon-weibo" href="http://service.weibo.com/share/share.php?title=%E7%94%B1swap%E5%BC%95%E5%87%BA%E7%9A%84java%E4%B8%AD%E5%8F%82%E6%95%B0%E4%B8%A5%E6%A0%BC%E5%80%BC%E4%BC%A0%E9%80%92%E9%97%AE%E9%A2%98&amp;url=http://atleeon.com/code/2013/11/28/java-swap-value"
                  onclick="window.open(this.href, 'weibo-share', 'width=550,height=255');return false;">
                <i class="fa fa-weibo"></i><span class="hidden">weibo</span>
                </a>
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>戳</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(http://cdn4atleeon.qiniudn.com/image/site/author/leeon/leeon.jpg)">Blog Logo</div>
              <h4>Leeon</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">写于 
                <time datetime="2013-11-28 00:00">
                    2013 年 11 月 28 日
                </time>
              </p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span> 乱步 </span></h5>
            <footer class="site-footer">
              
              <p class="published" style="text-align: center;">
                  <a href="/code/2013/10/24/implementation-of-android-inputmethod.html" class="pre">
                    <i class="fa fa-caret-left"></i>
                    实现一个Android输入法 
                  </a>
              </p>
              

              
              <p class="published" style="text-align: center;">
                <a href="/code/2013/11/29/java-equals-hashcode.html" class="next"> 
                  Java中hashcode()和equals()的联系 
                  <i class="fa fa-caret-right"></i>
                </a>
              </p>
              

              <!-- <a class="subscribe" href="/feed.xml"> <span class="tooltip">  -->
              </div>
            </footer>
          </div>
        </div>
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/cA4aKEIPQrerBnp1yGHv_IMG_9534-3-2.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Zephyrus</h1>
        <h2 class="blog-description"></h2>
        <a href="/" class="btn">首 页</a>
      </div>
    </div>
  </body>
</html>
